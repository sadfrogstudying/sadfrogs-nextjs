// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

generator client {
    provider = "prisma-client-js"
}

model StudySpot {
    id          Int      @id @default(autoincrement())
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    isValidated Boolean  @default(false)

    // general (if people submit a study spot they must fill these out)
    name         String  @unique
    slug         String  @unique
    rating       Float   @default(0)
    wifi         Boolean @default(false)
    powerOutlets Boolean @default(false)
    noiseLevel   String  @default("")
    venueType    String  @default("")
    images       Image[] // if StudySpot is deleted, all images are deleted (default behavior)

    // location
    placeId   String @default("")
    latitude  Float  @default(0)
    longitude Float  @default(0)
    address   String @default("")
    country   String @default("")
    city      String @default("")
    state     String @default("")

    // hours
    openingHours OpeningHours[]

    // etiquette
    canStudyForLong String @default("")

    // ambiance
    vibe        String  @default("")
    comfort     String  @default("")
    views       String  @default("")
    sunlight    Boolean @default(false)
    temperature String  @default("")
    music       String  @default("")
    lighting    String  @default("")

    // crowdedness
    distractions String @default("")
    crowdedness  String @default("")

    // surroundings
    naturalSurroundings  String @default("")
    proximityToAmenities String @default("")

    // amenities
    drinks               Boolean @default(false)
    food                 Boolean @default(false)
    studyBreakFacilities String  @default("")

    pendingEditStudySpot PendingEdit[]
}

model PendingEdit {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // general (if people submit a study spot they must fill these out)
    name         String?
    slug         String?
    rating       Float?
    wifi         Boolean?
    powerOutlets Boolean?
    noiseLevel   String?
    venueType    String?

    // location
    placeId   String?
    latitude  Float?
    longitude Float?
    address   String?
    country   String?
    city      String?
    state     String?

    // hours
    openingHours OpeningHours[]

    // etiquette
    canStudyForLong String?

    // ambiance
    vibe        String?
    comfort     String?
    views       String?
    sunlight    Boolean?
    temperature String?
    music       String?
    lighting    String?

    // crowdedness
    distractions String?
    crowdedness  String?

    // surroundings
    naturalSurroundings  String?
    proximityToAmenities String?

    // amenities
    drinks               Boolean?
    food                 Boolean?
    studyBreakFacilities String?

    studySpot   StudySpot @relation(fields: [studySpotId], references: [id])
    studySpotId Int

    pendingImagesToAdd    PendingImagesToAdd[]
    pendingImagesToDelete PendingImagesToDelete[]

    @@index([studySpotId])
}

model OpeningHours {
    id            Int          @id @default(autoincrement())
    day           Int
    openingTime   String
    closingTime   String
    StudySpot     StudySpot?   @relation(fields: [studySpotId], references: [id], onDelete: Cascade)
    studySpotId   Int?         @unique
    pendingEdit   PendingEdit? @relation(fields: [pendingEditId], references: [id])
    pendingEditId String?      @unique
}

model Image {
    id             Int    @id @default(autoincrement())
    name           String @unique
    dominantColour String @default("#fff")
    aspectRatio    Float
    height         Int
    width          Int

    studySpot   StudySpot? @relation(fields: [studySpotId], references: [id], onDelete: Cascade)
    studySpotId Int?

    pendingImagesToAdd    PendingImagesToAdd[]
    pendingImagesToDelete PendingImagesToDelete[]

    @@index([studySpotId])
}

model PendingImagesToAdd {
    image   Image @relation(fields: [imageId], references: [id])
    imageId Int // relation scalar field (used in the `@relation` attribute above)

    pendingEdit   PendingEdit? @relation(fields: [pendingEditId], references: [id])
    pendingEditId String

    @@id([imageId, pendingEditId])
    @@index([imageId])
    @@index([pendingEditId])
}

model PendingImagesToDelete {
    image   Image @relation(fields: [imageId], references: [id])
    imageId Int // relation scalar field (used in the `@relation` attribute above)

    pendingEdit   PendingEdit? @relation(fields: [pendingEditId], references: [id])
    pendingEditId String

    @@id([imageId, pendingEditId])
    @@index([imageId])
    @@index([pendingEditId])
}
